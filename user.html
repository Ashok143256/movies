<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GO DISH - Welcome</title>
    
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&family=Teko:wght@400;600&display=swap" rel="stylesheet">
    
    <!-- Icons (Feather Icons) -->
    <script src="https://unpkg.com/feather-icons"></script>

    <style>
        /* CSS Reset & Theming */
        :root {
            --primary-color: #0f0c29;
            --secondary-color: #24243e;
            --accent-blue: #00c6ff;
            --accent-purple: #923cb5;
            --glow-blue: rgba(0, 198, 255, 0.5);
            --glow-purple: rgba(146, 59, 181, 0.6);
            --text-color: #f0f0f0;
            --text-muted: #b0b0b0;
            --border-color: rgba(255, 255, 255, 0.1);
            --font-main: 'Roboto', sans-serif;
            --font-display: 'Teko', sans-serif;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: var(--font-main);
            background: linear-gradient(to right, #0f0c29, #302b63, #24243e);
            color: var(--text-color);
            overflow-x: hidden;
        }

        /* --- LOADER --- */
        .loader-container {
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background: var(--primary-color);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            transition: opacity 0.5s ease;
        }
        .loader {
            width: 50px;
            height: 50px;
            border: 5px solid var(--border-color);
            border-top-color: var(--accent-blue);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* --- AUTHENTICATION PAGE --- */
        #auth-page {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
        }

        .auth-container {
            width: 100%;
            max-width: 420px;
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 40px;
            backdrop-filter: blur(10px);
            box-shadow: 0 0 40px rgba(0,0,0,0.5);
            text-align: center;
        }
        
        .auth-container h1 {
            font-family: var(--font-display);
            font-size: 3.5rem;
            background: linear-gradient(90deg, var(--accent-blue), var(--accent-purple));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: 0 0 15px var(--glow-blue);
            margin-bottom: 30px;
        }
        
        .auth-form {
            display: none;
        }
        .auth-form.active {
            display: block;
        }

        .input-group {
            margin-bottom: 20px; text-align: left;
        }
        .input-group input {
            width: 100%; padding: 12px;
            background: var(--secondary-color);
            border: 1px solid var(--border-color);
            border-radius: 8px; color: var(--text-color);
            font-size: 1rem; transition: all 0.3s ease;
        }
        .input-group input:focus {
            outline: none;
            box-shadow: 0 0 10px var(--glow-blue), 0 0 10px var(--glow-purple);
            border-color: var(--accent-blue);
        }

        .btn-glow {
            width: 100%; padding: 12px; font-size: 1rem;
            border: none; border-radius: 8px; color: white;
            background: linear-gradient(90deg, var(--accent-blue), var(--accent-purple));
            cursor: pointer; transition: all 0.3s ease;
            text-transform: uppercase; letter-spacing: 1px;
        }
        .btn-glow:hover {
            box-shadow: 0 0 20px var(--glow-blue);
            transform: translateY(-2px);
        }

        .auth-toggle {
            margin-top: 20px;
        }
        .auth-toggle a {
            color: var(--accent-blue); cursor: pointer; text-decoration: none;
        }
        .auth-toggle a:hover { text-decoration: underline; }

        /* --- MAIN APP CONTAINER --- */
        #main-app {
            display: none;
            padding-bottom: 80px; /* Space for bottom nav */
        }
        
        /* App Pages */
        .app-page {
            display: none;
            padding: 20px;
            animation: pageFadeIn 0.5s ease;
        }
        .app-page.active { display: block; }
        @keyframes pageFadeIn {
            from { opacity: 0; transform: translateY(15px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* --- HOME PAGE STYLES --- */
        .search-container {
            display: flex; gap: 10px; margin-bottom: 30px;
        }
        .search-container input {
            flex-grow: 1; padding: 12px 15px; background: var(--secondary-color);
            border: 1px solid var(--border-color); border-radius: 25px;
            color: var(--text-color); font-size: 1rem;
        }
        .search-container input:focus { outline: none; border-color: var(--accent-purple); }

        .category-filters {
            display: flex; flex-wrap: wrap; gap: 10px; margin-bottom: 30px;
        }
        .filter-chip {
            padding: 8px 15px; background: var(--secondary-color);
            border: 1px solid var(--border-color); border-radius: 20px;
            cursor: pointer; transition: all 0.3s ease;
        }
        .filter-chip:hover, .filter-chip.active {
            background: linear-gradient(90deg, var(--accent-blue), var(--accent-purple));
            color: white; border-color: transparent;
            box-shadow: 0 0 15px var(--glow-blue);
        }

        .section-title {
            font-family: var(--font-display);
            font-size: 2.5rem; letter-spacing: 1px;
            margin-bottom: 20px;
            border-left: 4px solid var(--accent-blue);
            padding-left: 15px;
        }

        .movie-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
            gap: 20px;
        }
        
        .movie-card {
            background: var(--secondary-color); border-radius: 8px;
            overflow: hidden; cursor: pointer;
            position: relative; transition: all 0.4s ease;
            border: 1px solid transparent;
        }
        .movie-card:hover {
            transform: scale(1.05);
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            border-color: var(--accent-blue);
        }
        
        .movie-card img {
            width: 100%; height: 240px; object-fit: cover; display: block;
        }
        .movie-card-title {
            padding: 10px; font-size: 0.9rem;
            white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
        }

        /* --- MOVIE DETAILS PAGE --- */
        #movie-details-page .back-btn {
            margin-bottom: 20px; background: none; border: none; color: var(--text-color);
            display: flex; align-items: center; gap: 8px; font-size: 1rem; cursor: pointer;
        }
        .details-content {
            display: flex; gap: 30px; flex-direction: column;
        }
        .details-content img {
            width: 100%; max-width: 300px; border-radius: 10px;
        }
        .details-info h2 {
            font-family: var(--font-display); font-size: 3rem; margin-bottom: 10px;
        }
        .details-meta {
            display: flex; gap: 20px; margin-bottom: 20px; color: var(--text-muted);
        }
        .details-meta span { display: flex; align-items: center; gap: 5px; }
        .details-description { line-height: 1.6; margin-bottom: 30px; }

        /* --- PROFILE PAGE --- */
        #profile-page { text-align: center; padding-top: 50px; }
        #profile-page h2 { font-size: 2rem; margin-bottom: 10px; }
        #profile-page p { color: var(--text-muted); margin-bottom: 30px; }

        /* --- BOTTOM NAVIGATION --- */
        .bottom-nav {
            position: fixed; bottom: 0; left: 0; width: 100%;
            background: rgba(0, 0, 0, 0.5); backdrop-filter: blur(10px);
            display: flex; justify-content: space-around;
            padding: 10px 0; border-top: 1px solid var(--border-color);
            z-index: 100;
        }
        .nav-item {
            display: flex; flex-direction: column; align-items: center;
            color: var(--text-muted); text-decoration: none;
            transition: all 0.3s ease;
        }
        .nav-item.active {
            color: var(--accent-blue);
            text-shadow: 0 0 10px var(--glow-blue);
        }
        .nav-item:hover { color: var(--accent-blue); }
        .nav-item span { font-size: 0.7rem; margin-top: 4px; }
        
        /* --- TRAILER MODAL --- */
        .modal {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.8); backdrop-filter: blur(5px);
            display: none; justify-content: center; align-items: center; z-index: 1000;
        }
        .modal-content {
            width: 90%; max-width: 900px;
            aspect-ratio: 16 / 9; position: relative;
        }
        .modal-content iframe {
            width: 100%; height: 100%; border: none;
        }
        .modal-close {
            position: absolute; top: -40px; right: 0;
            background: none; border: none; color: white; font-size: 2rem; cursor: pointer;
        }
        
        /* --- TOAST NOTIFICATION --- */
        .toast {
            position: fixed; top: 20px; right: 20px;
            padding: 12px 20px; border-radius: 8px; color: white;
            z-index: 2000; opacity: 0; transform: translateY(-20px);
            transition: all 0.4s ease; font-weight: 500;
        }
        .toast.show { opacity: 1; transform: translateY(0); }
        .toast.error { background: #e74c3c; }

        /* --- RESPONSIVENESS --- */
        @media (min-width: 768px) {
            #main-app { padding-bottom: 20px; } /* Reset padding for desktop */
            .details-content { flex-direction: row; }
            .details-content img { width: 300px; height: 450px; object-fit: cover; }
            .movie-grid { grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); }
            .movie-card img { height: 300px; }
        }
    </style>
</head>
<body>

    <!-- App Loader -->
    <div id="loader" class="loader-container">
        <div class="loader"></div>
    </div>

    <!-- ======================= -->
    <!--   AUTHENTICATION PAGE   -->
    <!-- ======================= -->
    <div id="auth-page">
        <div class="auth-container">
            <h1>GO DISH</h1>
            <!-- Login Form -->
            <form id="login-form" class="auth-form active">
                <div class="input-group">
                    <input type="email" id="login-email" placeholder="Email" required>
                </div>
                <div class="input-group">
                    <input type="password" id="login-password" placeholder="Password" required>
                </div>
                <button type="submit" class="btn-glow">Login</button>
                <p class="auth-toggle">No account? <a id="show-register">Register</a> | <a id="forgot-password">Forgot Password?</a></p>
            </form>
            <!-- Register Form -->
            <form id="register-form" class="auth-form">
                <div class="input-group">
                    <input type="email" id="register-email" placeholder="Email" required>
                </div>
                <div class="input-group">
                    <input type="password" id="register-password" placeholder="Password" required>
                </div>
                <button type="submit" class="btn-glow">Register</button>
                <p class="auth-toggle">Already have an account? <a id="show-login">Login</a></p>
            </form>
        </div>
    </div>
    
    <!-- ======================= -->
    <!--       MAIN APP          -->
    <!-- ======================= -->
    <div id="main-app">
        <!-- Home Page -->
        <div id="home-page" class="app-page active">
            <div class="search-container">
                <input type="text" id="search-bar" placeholder="Search by title or genre...">
            </div>
            <div id="category-filters-container" class="category-filters"></div>
            
            <div id="search-results" style="display:none;">
                <h2 class="section-title">Search Results</h2>
                <div class="movie-grid" id="search-results-grid"></div>
            </div>
            
            <div id="main-content">
                <h2 class="section-title">Top Rated</h2>
                <div class="movie-grid" id="top-rated-grid"></div>
                <br><br>
                <h2 class="section-title">All Movies</h2>
                <div class="movie-grid" id="all-movies-grid"></div>
            </div>
        </div>

        <!-- Movie Details Page -->
        <div id="movie-details-page" class="app-page">
            <button class="back-btn"><i data-feather="arrow-left"></i> Back to Home</button>
            <div class="details-content" id="details-content-container">
                <!-- Details injected by JS -->
            </div>
        </div>

        <!-- Categories Page (Placeholder) -->
        <div id="categories-page" class="app-page">
            <h1 class="section-title">Categories</h1>
            <p>This section can be expanded with more detailed category browsing.</p>
            <div id="full-category-list" class="category-filters">
                <!-- Category chips will be injected here -->
            </div>
        </div>

        <!-- Profile Page -->
        <div id="profile-page" class="app-page">
            <h2 id="profile-email"></h2>
            <p>Welcome to GO DISH!</p>
            <button id="logout-btn" class="btn-glow">Logout</button>
        </div>

        <!-- Bottom Navigation -->
        <nav class="bottom-nav">
            <a href="#" class="nav-item active" data-page="home-page"><i data-feather="home"></i><span>Home</span></a>
            <a href="#" class="nav-item" data-page="categories-page"><i data-feather="grid"></i><span>Categories</span></a>
            <a href="#" class="nav-item" data-page="profile-page"><i data-feather="user"></i><span>Profile</span></a>
        </nav>
    </div>

    <!-- Trailer Modal -->
    <div id="trailer-modal" class="modal">
        <div class="modal-content">
            <button id="modal-close-btn" class="modal-close">&times;</button>
            <iframe id="trailer-iframe" src="" allow="autoplay; encrypted-media" allowfullscreen></iframe>
        </div>
    </div>
    
    <!-- Toast Notification -->
    <div id="toast-notification" class="toast"></div>

    <!-- ======================= -->
    <!-- JAVASCRIPT & FIREBASE   -->
    <!-- ======================= -->
    <script type="module">
        // Firebase Imports
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-app.js";
        import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, onAuthStateChanged, signOut, sendPasswordResetEmail } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-auth.js";
        import { getFirestore, collection, onSnapshot, doc, setDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-firestore.js";

        // Firebase Config
        const firebaseConfig = {
            apiKey: "AIzaSyDfKHrJYE9fVXGzlSY7Bha4h2DRqjRVou4",
            authDomain: "tg-move.firebaseapp.com",
            databaseURL: "https://tg-move-default-rtdb.firebaseio.com",
            projectId: "tg-move",
            storageBucket: "tg-move.firebasestorage.app",
            messagingSenderId: "39801339042",
            appId: "1:39801339042:web:b55efc89b502fe49b76bfb"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        // Global State
        let allMovies = [];

        // DOM Elements
        const loader = document.getElementById('loader');
        const authPage = document.getElementById('auth-page');
        const mainApp = document.getElementById('main-app');
        const pages = document.querySelectorAll('.app-page');
        const navItems = document.querySelectorAll('.nav-item');
        
        // --- INITIALIZATION ---
        feather.replace(); // Initialize Feather Icons
        
        // --- AUTHENTICATION LISTENER ---
        onAuthStateChanged(auth, user => {
            if (user) {
                authPage.style.display = 'none';
                mainApp.style.display = 'block';
                document.getElementById('profile-email').textContent = user.email;
                fetchMovies();
            } else {
                authPage.style.display = 'flex';
                mainApp.style.display = 'none';
            }
            loader.style.opacity = '0';
            setTimeout(() => loader.style.display = 'none', 500);
        });

        // --- AUTH FORMS LOGIC ---
        const loginForm = document.getElementById('login-form');
        const registerForm = document.getElementById('register-form');

        document.getElementById('show-register').addEventListener('click', () => {
            loginForm.classList.remove('active');
            registerForm.classList.add('active');
        });
        document.getElementById('show-login').addEventListener('click', () => {
            registerForm.classList.remove('active');
            loginForm.classList.add('active');
        });
        
        loginForm.addEventListener('submit', e => {
            e.preventDefault();
            const email = document.getElementById('login-email').value;
            const password = document.getElementById('login-password').value;
            signInWithEmailAndPassword(auth, email, password)
                .catch(err => showToast(`Login failed: ${err.message}`, 'error'));
        });

        registerForm.addEventListener('submit', async e => {
            e.preventDefault();
            const email = document.getElementById('register-email').value;
            const password = document.getElementById('register-password').value;
            try {
                const userCredential = await createUserWithEmailAndPassword(auth, email, password);
                // Also create a user document in Firestore for the admin panel
                await setDoc(doc(db, 'users', userCredential.user.uid), {
                    email: userCredential.user.email,
                    registrationDate: serverTimestamp(),
                    status: 'active'
                });
            } catch (err) {
                showToast(`Registration failed: ${err.message}`, 'error');
            }
        });
        
        document.getElementById('logout-btn').addEventListener('click', () => signOut(auth));
        
        document.getElementById('forgot-password').addEventListener('click', () => {
            const email = prompt("Please enter your email for password reset:");
            if(email) {
                sendPasswordResetEmail(auth, email)
                .then(() => showToast('Password reset email sent!', 'success'))
                .catch(err => showToast(err.message, 'error'));
            }
        });

        // --- DATA FETCHING & RENDERING ---
        function fetchMovies() {
            const moviesCollection = collection(db, 'movies');
            onSnapshot(moviesCollection, snapshot => {
                allMovies = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                renderAllMovies(allMovies);
                renderTopRated(allMovies);
                renderCategoryFilters(allMovies);
            });
        }

        function createMovieCard(movie) {
            return `
                <div class="movie-card" data-id="${movie.id}">
                    <img src="${movie.posterUrl}" alt="${movie.title}" loading="lazy">
                    <div class="movie-card-title">${movie.title}</div>
                </div>
            `;
        }

        function renderAllMovies(movies) {
            const grid = document.getElementById('all-movies-grid');
            grid.innerHTML = movies.map(createMovieCard).join('');
        }

        function renderTopRated(movies) {
            const topRated = [...movies].sort((a, b) => b.rating - a.rating).slice(0, 5);
            const grid = document.getElementById('top-rated-grid');
            grid.innerHTML = topRated.map(createMovieCard).join('');
        }
        
        function renderCategoryFilters(movies) {
            const genres = new Set();
            movies.forEach(movie => {
                movie.genre.split(',').forEach(g => genres.add(g.trim()));
            });
            const filtersContainer = document.getElementById('category-filters-container');
            const fullCategoryList = document.getElementById('full-category-list');
            
            let filtersHTML = '<div class="filter-chip active" data-genre="All">All</div>';
            genres.forEach(genre => {
                filtersHTML += `<div class="filter-chip" data-genre="${genre}">${genre}</div>`;
            });
            filtersContainer.innerHTML = filtersHTML;
            fullCategoryList.innerHTML = filtersHTML;
        }

        // --- SEARCH AND FILTER LOGIC ---
        const searchBar = document.getElementById('search-bar');
        searchBar.addEventListener('input', () => {
            const query = searchBar.value.toLowerCase();
            if (query.length > 0) {
                const filteredMovies = allMovies.filter(movie => 
                    movie.title.toLowerCase().includes(query) || 
                    movie.genre.toLowerCase().includes(query)
                );
                document.getElementById('search-results-grid').innerHTML = filteredMovies.map(createMovieCard).join('');
                document.getElementById('search-results').style.display = 'block';
                document.getElementById('main-content').style.display = 'none';
            } else {
                document.getElementById('search-results').style.display = 'none';
                document.getElementById('main-content').style.display = 'block';
            }
        });

        document.getElementById('category-filters-container').addEventListener('click', e => {
            if (e.target.classList.contains('filter-chip')) {
                document.querySelectorAll('#category-filters-container .filter-chip').forEach(chip => chip.classList.remove('active'));
                e.target.classList.add('active');
                
                const genre = e.target.dataset.genre;
                if (genre === 'All') {
                    renderAllMovies(allMovies);
                } else {
                    const filteredMovies = allMovies.filter(movie => movie.genre.includes(genre));
                    renderAllMovies(filteredMovies);
                }
            }
        });

        // --- PAGE NAVIGATION ---
        function navigateTo(pageId) {
            pages.forEach(page => page.classList.remove('active'));
            document.getElementById(pageId).classList.add('active');
            navItems.forEach(item => {
                item.classList.toggle('active', item.dataset.page === pageId);
            });
        }
        
        navItems.forEach(item => {
            item.addEventListener('click', (e) => {
                e.preventDefault();
                navigateTo(item.dataset.page);
            });
        });

        // --- MOVIE DETAILS LOGIC ---
        document.body.addEventListener('click', e => {
            const card = e.target.closest('.movie-card');
            if (card) {
                const movieId = card.dataset.id;
                renderMovieDetails(movieId);
                navigateTo('movie-details-page');
            }
        });

        document.querySelector('.back-btn').addEventListener('click', () => navigateTo('home-page'));

        function renderMovieDetails(movieId) {
            const movie = allMovies.find(m => m.id === movieId);
            const container = document.getElementById('details-content-container');
            container.innerHTML = `
                <img src="${movie.posterUrl}" alt="${movie.title}">
                <div class="details-info">
                    <h2>${movie.title}</h2>
                    <div class="details-meta">
                        <span><i data-feather="calendar"></i> ${movie.releaseYear}</span>
                        <span><i data-feather="tag"></i> ${movie.genre}</span>
                        <span><i data-feather="star"></i> ${movie.rating} / 10</span>
                    </div>
                    <p class="details-description">${movie.description}</p>
                    <button class="btn-glow watch-trailer-btn" data-trailer="${movie.trailerUrl}">Watch Trailer</button>
                </div>
            `;
            feather.replace();
        }

        // --- TRAILER MODAL LOGIC ---
        const trailerModal = document.getElementById('trailer-modal');
        const trailerIframe = document.getElementById('trailer-iframe');
        
        document.body.addEventListener('click', e => {
            if (e.target.classList.contains('watch-trailer-btn')) {
                const trailerUrl = e.target.dataset.trailer;
                // Convert YouTube watch URL to embed URL
                const embedUrl = trailerUrl.replace("watch?v=", "embed/");
                trailerIframe.src = embedUrl;
                trailerModal.style.display = 'flex';
            }
        });
        
        document.getElementById('modal-close-btn').addEventListener('click', () => {
            trailerIframe.src = ""; // Stop video playback
            trailerModal.style.display = 'none';
        });

        // --- UTILITY: TOAST NOTIFICATION ---
        function showToast(message, type = 'success') {
            const toast = document.getElementById('toast-notification');
            toast.textContent = message;
            toast.className = `toast ${type}`;
            toast.classList.add('show');
            setTimeout(() => {
                toast.classList.remove('show');
            }, 3000);
        }

    </script>
</body>
</html>